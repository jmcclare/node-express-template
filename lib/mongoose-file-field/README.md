# mongoose-file-field #

Mongoose File Field is a file attachment plugin for
[Mongoose.js](http://mongoosejs.com/). It adds a field to your Mongoose schema
that can store a file. It adds methods for attaching, linking and deleting
attached files.

The files are expected to be [Multer](https://github.com/expressjs/multer) file
objects, but you can create an object with the same fields filled in to store
any file you have on the local disk.


## Usage ##

In the file where you define your schema. In this example, we'll call it
`postSchema` and the `Post` model.

    ff = require 'mongoose-file-field'

    # Define the schema
    postSchema = mongoose.Schema
      name:
        type: String
        required: true

    # Set the options
    fOptions =
      fieldName: 'download'
      fileStoreOptions:
        collection: 'post-download'

    # Add the ff plugin
    postSchema.plugin ff, fOptions

    Post = mongoose.model('Post', postSchema)

    module.exports = Post

### Plugin Options ###

`fieldName`: The name of the file field to add to the schema. You can add
multiple file fields with this plugin, but you must give each of them a unique
name. Defaults to 'file'.

`fileStoreOptions`: Options object to pass to `FileStore` when storing the
file. See the `file-store` docs for available options. This can be omitted
completely. The most likely options you will want to fill in this object are
`collection` and maybe `subCollection`.

### Functions ###

#### updateff ####

To attach a new file, in a route that handles a file upload form:

    if req.files.file1.length > 0
      post.updateff 'download', req.files.file1, (err) ->
        if err
          debug err
          req.flash 'error', 'Error storing file 1.'
        post.save (err) ->
          if err
            debug err
            req.flash 'error', 'Post could not be saved.'
          else
            req.flash 'info', 'Post saved.'
          return res.redirect app.locals.urls['posts']

The first parameter is the name of the file field you are updating.

The second parameter is expected to be a `multer` file object, or an object
with the same fields filled in with the path to a file on disk that is to be
moved into storage.

The third field can be an options object for `FileStore::store()`. See the
`FileStore` docs for more on that. It is best to only set file specific options
here like `name` or `description`.

The fourth parameter is a callback function that takes an `Error` object which
will be `null` if no errors are encountered.

#### ffurl ####

To get the URL of a file field's file:

  downloadURL = post.ffurl 'download'

The only parameter is the name of the file field.

It returns the URL of the file field's stored file as generated by `FileStore`.
It returns an empty string if the field currently does not have a stored file.

#### clearff ####

To delete a file field's stored file:

  post.clearff 'download', (err)->
    if err
      # deal with the error however you wish
      debug err
    else
      # The file was successfully deleted
      # move on and do other stuffâ€¦

The first parameter is the name of the file field to clear.

The second is a callback function that takes an optional `Error` object.
